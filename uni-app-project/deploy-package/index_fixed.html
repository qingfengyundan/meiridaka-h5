<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥æ‰“å¡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 414px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            position: relative;
        }
        
        .status-bar {
            height: 44px;
            background: #000;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .page {
            display: none;
            min-height: calc(100vh - 124px);
            padding-bottom: 80px;
        }
        
        .page.active {
            display: block;
        }
        
        .page-transition {
            transition: all 0.3s ease-in-out;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }
        
        .header .date {
            opacity: 0.9;
            font-size: 0.9em;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background: #e5e7eb;
            margin: 20px;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .stat-item {
            background: white;
            padding: 15px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }
        
        .section {
            margin: 20px;
        }
        
        .section-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .task-list {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .task-item {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .task-item:last-child {
            border-bottom: none;
        }
        
        .task-item:hover {
            background: #f8f9fa;
        }
        
        .task-item.completed {
            opacity: 0.6;
        }
        
        .task-item.completed .task-title {
            text-decoration: line-through;
        }
        
        .task-checkbox {
            font-size: 1.5em;
            cursor: pointer;
        }
        
        .task-content {
            flex: 1;
        }
        
        .task-title {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .task-meta {
            font-size: 0.8em;
            color: #666;
            display: flex;
            gap: 10px;
        }
        
        .task-points {
            color: #f59e0b;
            font-weight: 500;
        }
        
        .add-task {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            width: 100%;
            font-size: 1em;
            cursor: pointer;
            margin-top: 15px;
            transition: background 0.2s;
        }
        
        .add-task:hover {
            background: #5a67d8;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 414px;
            background: white;
            border-top: 1px solid #e5e7eb;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
        }
        
        .nav-item {
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: background 0.2s;
            border: none;
            background: none;
            font-size: 0.8em;
        }
        
        .nav-item:hover {
            background: #f8f9fa;
        }
        
        .nav-item.active {
            color: #667eea;
            background: #f0f4ff;
        }
        
        .nav-icon {
            font-size: 1.2em;
            margin-bottom: 4px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
        }
        
        .modal-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }
        
        .form-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-secondary {
            background: #e5e7eb;
            color: #333;
        }
        
        /* ä»»åŠ¡æ¨¡æ¿æŒ‰é’®æ ·å¼ */
        .template-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 8px;
        }
        
        .template-btn {
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            color: #666;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
            text-align: center;
        }
        
        .template-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }
        
        .template-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        /* ä¼˜å…ˆçº§æŒ‰é’®æ ·å¼ */
        .priority-buttons {
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }
        
        .priority-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            color: #666;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .priority-btn:hover {
            border-color: #667eea;
        }
        
        .priority-btn.active {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .priority-btn[data-priority="low"].active {
            border-color: #10b981;
            background: #ecfdf5;
        }
        
        .priority-btn[data-priority="medium"].active {
            border-color: #f59e0b;
            background: #fffbeb;
        }
        
        .priority-btn[data-priority="high"].active {
            border-color: #ef4444;
            background: #fef2f2;
        }
        
        .priority-icon {
            font-size: 1.2em;
        }
        
        /* ä»»åŠ¡é¡¹ä¼˜å…ˆçº§æŒ‡ç¤ºå™¨ */
        .task-item {
            position: relative;
        }
        
        .task-item[data-priority="high"]::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #ef4444;
            border-radius: 0 4px 4px 0;
        }
        
        .task-item[data-priority="medium"]::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #f59e0b;
            border-radius: 0 4px 4px 0;
        }
        
        .task-item[data-priority="low"]::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #10b981;
            border-radius: 0 4px 4px 0;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .empty-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }
        
        /* é¦–é¡µæ ·å¼ */
        .welcome-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
            position: relative;
        }
        
        .edit-profile-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
        }
        
        .avatar {
            width: 80px;
            height: 80px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            margin: 0 auto 15px;
        }
        
        .user-name {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .user-level {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 15px;
        }
        
        .points-display {
            font-size: 1.1em;
            font-weight: 500;
        }
        
        .progress-section {
            padding: 20px;
            background: white;
        }
        
        .progress-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .progress-bar-container {
            background: #e5e7eb;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            font-size: 14px;
            color: #666;
            text-align: center;
        }
        
        /* å¿«é€Ÿç»Ÿè®¡æ ·å¼ */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .quick-stat-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .quick-stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .quick-stat-label {
            font-size: 14px;
            color: #666;
        }
        
        /* æœ€æ–°æˆå°±æ ·å¼ */
        .recent-achievements {
            padding: 20px;
        }
        
        .achievement-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .achievement-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }
        
        .achievement-item.unlocked {
            border-left-color: #34c759;
        }
        
        .achievement-icon {
            font-size: 24px;
            margin-right: 15px;
        }
        
        .achievement-info {
            flex: 1;
        }
        
        .achievement-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .achievement-desc {
            font-size: 14px;
            color: #666;
        }
        
        /* ç»Ÿè®¡é¡µé¢æ ·å¼ */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-card-title {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }
        
        .stat-card-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .stat-card-desc {
            font-size: 0.8em;
            color: #999;
        }
        
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .chart {
            height: 200px;
            display: flex;
            align-items: end;
            justify-content: space-between;
            gap: 8px;
        }
        
        .chart-bar {
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 4px 4px 0 0;
            min-height: 20px;
            flex: 1;
            position: relative;
        }
        
        .chart-day {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7em;
            color: #666;
        }
        
        .history-list {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .history-item {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-date {
            font-weight: 500;
        }
        
        .history-count {
            color: #667eea;
            font-weight: bold;
        }
        
        /* å•†åŸé¡µé¢æ ·å¼ */
        .points-balance {
            margin-bottom: 20px;
        }
        
        .balance-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }
        
        .balance-title {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 8px;
        }
        
        .balance-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .balance-desc {
            font-size: 0.8em;
            opacity: 0.8;
            margin-bottom: 15px;
        }
        
        .history-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .history-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
        }
        
        .shop-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        
        .category-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 20px;
            background: white;
            color: #666;
            font-size: 0.9em;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }
        
        .category-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .shop-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .shop-item {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .shop-item:hover {
            transform: translateY(-2px);
        }
        
        .shop-item-image {
            height: 120px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
        }
        
        .shop-item-info {
            padding: 15px;
        }
        
        .shop-item-name {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .shop-item-price {
            color: #f59e0b;
            font-weight: bold;
        }
        
        /* ä¸ªäººä¸­å¿ƒé¡µé¢æ ·å¼ */
        .profile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .avatar {
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }
        
        .profile-info {
            flex: 1;
        }
        
        .username {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .user-level {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .profile-stats {
            display: flex;
            gap: 20px;
        }
        
        .profile-stat {
            text-align: center;
        }
        
        .profile-stat-value {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .profile-stat-label {
            font-size: 0.8em;
            opacity: 0.8;
        }
        
        .profile-menu {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .menu-item {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .menu-item:last-child {
            border-bottom: none;
        }
        
        .menu-item:hover {
            background: #f8f9fa;
        }
        
        .menu-icon {
            font-size: 1.2em;
        }
        
        .menu-text {
            flex: 1;
            font-weight: 500;
        }
        
        .menu-arrow {
            color: #ccc;
        }
        
        .profile-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            color: #666;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background: #f8f9fa;
        }
        
        @media (max-width: 414px) {
            .app {
                margin: 0;
                box-shadow: none;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .shop-items {
                grid-template-columns: 1fr;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-stats {
                justify-content: center;
            }
        }

        /* å®¶é•¿ç®¡ç†é¡µé¢æ ·å¼ */
        .mode-switch {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        .current-mode {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            color: #495057;
        }

        .switch-mode-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }

        .switch-mode-btn:hover {
            background: #0056b3;
        }

        .parent-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .parent-section-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .task-points-list {
            margin-bottom: 15px;
        }

        .data-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .analysis-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .analysis-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .analysis-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }

        .reward-management {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .reward-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 16px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }

        .reward-btn:hover {
            background: #218838;
        }

        .parent-settings {
            background: #f8f9fa;
            border-radius: 8px;
            overflow: hidden;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: background 0.2s;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-item:hover {
            background: #e9ecef;
        }

        .setting-arrow {
            color: #6c757d;
            font-size: 18px;
        }

        /* æ¨¡å¼åˆ‡æ¢å¼¹çª— */
        .mode-switch-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .mode-switch-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .mode-switch-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .password-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
            text-align: center;
        }

        .password-input:focus {
            outline: none;
            border-color: #007bff;
        }

        .mode-switch-buttons {
            display: flex;
            gap: 10px;
        }

        .mode-switch-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
        }

        .confirm-btn {
            background: #007bff;
            color: white;
        }

        .cancel-btn {
            background: #6c757d;
            color: white;
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="header">
            <h1>ğŸ“… æ¯æ—¥æ‰“å¡</h1>
            <div class="date" id="currentDate"></div>
        </div>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" id="totalTasks">0</div>
                <div class="stat-label">æ€»ä»»åŠ¡</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="completedTasks">0</div>
                <div class="stat-label">å·²å®Œæˆ</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="pendingTasks">0</div>
                <div class="stat-label">å¾…å®Œæˆ</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="totalPoints">0</div>
                <div class="stat-label">æ€»ç§¯åˆ†</div>
            </div>
        </div>
        
        <!-- é¦–é¡µ -->
        <div class="page active" id="homePage">
            <div class="welcome-section">
                <button class="edit-profile-btn" onclick="editProfile()">âœï¸</button>
                <div class="avatar" id="userAvatar">ğŸ‘¤</div>
                <div class="user-name" id="userName">å°æ˜</div>
                <div class="user-level" id="userLevel">Lv.1 æ–°æ‰‹</div>
                <div class="points-display">å½“å‰ç§¯åˆ†ï¼š<span id="homePoints">0</span></div>
            </div>
            
            <div class="progress-section">
                <div class="progress-title">ä»Šæ—¥è¿›åº¦</div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="dailyProgress" style="width: 0%"></div>
                </div>
                <div class="progress-text" id="progressText">0/0 ä»»åŠ¡å®Œæˆ</div>
            </div>
            
            <div class="quick-stats">
                <div class="quick-stat-item">
                    <div class="quick-stat-number" id="quickTotalTasks">0</div>
                    <div class="quick-stat-label">æ€»ä»»åŠ¡</div>
                </div>
                <div class="quick-stat-item">
                    <div class="quick-stat-number" id="quickCompletedTasks">0</div>
                    <div class="quick-stat-label">å·²å®Œæˆ</div>
                </div>
                <div class="quick-stat-item">
                    <div class="quick-stat-number" id="quickStreakDays">0</div>
                    <div class="quick-stat-label">è¿ç»­å¤©æ•°</div>
                </div>
            </div>
            
            <div class="recent-achievements">
                <div class="section-title">ğŸ† æœ€æ–°æˆå°±</div>
                <div class="achievement-list" id="recentAchievements">
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ†</div>
                        <p>æš‚æ— æˆå°±ï¼Œå®Œæˆä»»åŠ¡è§£é”æ›´å¤šæˆå°±ï¼</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ä»»åŠ¡é¡µé¢ -->
        <div class="page" id="tasksPage">
            <div class="task-categories">
                <button class="category-btn active" onclick="filterTasks('all')">å…¨éƒ¨</button>
                <button class="category-btn" onclick="filterTasks('school')">ğŸ“š å­¦æ ¡</button>
                <button class="category-btn" onclick="filterTasks('home')">ğŸ  å®¶åº­</button>
                <button class="category-btn" onclick="filterTasks('temp')">âš¡ ä¸´æ—¶</button>
            </div>
            
            <div class="task-list" id="taskList">
                <!-- å­¦æ ¡ä»»åŠ¡ -->
                <div class="task-item" data-category="school">
                    <div class="task-icon school">ğŸ“š</div>
                    <div class="task-content">
                        <div class="task-name">å®Œæˆæ•°å­¦ä½œä¸š</div>
                        <div class="task-meta">
                            <span>æ¯æ—¥ä»»åŠ¡</span>
                            <span class="task-points">+20ç§¯åˆ†</span>
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="check-btn" onclick="toggleTask(this)">âœ“</button>
                    </div>
                </div>
                
                <div class="task-item" data-category="school">
                    <div class="task-icon school">ğŸ“</div>
                    <div class="task-content">
                        <div class="task-name">èƒŒè¯µè‹±è¯­å•è¯</div>
                        <div class="task-meta">
                            <span>æ¯æ—¥ä»»åŠ¡</span>
                            <span class="task-points">+15ç§¯åˆ†</span>
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="check-btn" onclick="toggleTask(this)">âœ“</button>
                    </div>
                </div>
                
                <div class="task-item" data-category="school">
                    <div class="task-icon school">ğŸ”¬</div>
                    <div class="task-content">
                        <div class="task-name">å¤ä¹ ç‰©ç†çŸ¥è¯†ç‚¹</div>
                        <div class="task-meta">
                            <span>æ¯å‘¨ä»»åŠ¡</span>
                            <span class="task-points">+25ç§¯åˆ†</span>
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="check-btn" onclick="toggleTask(this)">âœ“</button>
                    </div>
                </div>
                
                <!-- å®¶åº­ä»»åŠ¡ -->
                <div class="task-item" data-category="home">
                    <div class="task-icon home">ğŸ§¹</div>
                    <div class="task-content">
                        <div class="task-name">æ•´ç†æˆ¿é—´</div>
                        <div class="task-meta">
                            <span>æ¯æ—¥ä»»åŠ¡</span>
                            <span class="task-points">+10ç§¯åˆ†</span>
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="check-btn" onclick="toggleTask(this)">âœ“</button>
                    </div>
                </div>
                
                <div class="task-item" data-category="home">
                    <div class="task-icon home">ğŸ½ï¸</div>
                    <div class="task-content">
                        <div class="task-name">å¸®å¿™æ´—ç¢—</div>
                        <div class="task-meta">
                            <span>æ¯æ—¥ä»»åŠ¡</span>
                            <span class="task-points">+8ç§¯åˆ†</span>
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="check-btn" onclick="toggleTask(this)">âœ“</button>
                    </div>
                </div>
                
                <div class="task-item" data-category="home">
                    <div class="task-icon home">ğŸ›’</div>
                    <div class="task-content">
                        <div class="task-name">é™ªå¦ˆå¦ˆä¹°èœ</div>
                        <div class="task-meta">
                            <span>å‘¨æœ«ä»»åŠ¡</span>
                            <span class="task-points">+15ç§¯åˆ†</span>
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="check-btn" onclick="toggleTask(this)">âœ“</button>
                    </div>
                </div>
                
                <!-- ä¸´æ—¶ä»»åŠ¡ -->
                <div class="task-item" data-category="temp">
                    <div class="task-icon temp">ğŸƒ</div>
                    <div class="task-content">
                        <div class="task-name">æ™¨è·‘30åˆ†é’Ÿ</div>
                        <div class="task-meta">
                            <span>æœ¬å‘¨ä»»åŠ¡</span>
                            <span class="task-points">+30ç§¯åˆ†</span>
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="check-btn" onclick="toggleTask(this)">âœ“</button>
                    </div>
                </div>
                
                <div class="task-item" data-category="temp">
                    <div class="task-icon temp">ğŸ“–</div>
                    <div class="task-content">
                        <div class="task-name">é˜…è¯»è¯¾å¤–ä¹¦</div>
                        <div class="task-meta">
                            <span>æœ¬å‘¨ä»»åŠ¡</span>
                            <span class="task-points">+20ç§¯åˆ†</span>
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="check-btn" onclick="toggleTask(this)">âœ“</button>
                    </div>
                </div>
            </div>
            
            <button class="add-task-btn" onclick="showAddTaskModal()">+</button>
        </div>
        
        <!-- ç»Ÿè®¡é¡µé¢ -->
        <div class="page" id="statsPage" style="display: none;">
            <div class="section">
                <div class="section-title">
                    ğŸ“Š æ•°æ®ç»Ÿè®¡
                </div>
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-card-title">æœ¬å‘¨å®Œæˆç‡</div>
                        <div class="stat-card-value" id="weeklyRate">0%</div>
                        <div class="stat-card-desc">å…±å®Œæˆ <span id="weeklyCompleted">0</span> ä¸ªä»»åŠ¡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-title">è¿ç»­æ‰“å¡</div>
                        <div class="stat-card-value" id="streakDays">0</div>
                        <div class="stat-card-desc">å¤©</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">æœ€è¿‘7å¤©å®Œæˆæƒ…å†µ</div>
                    <div class="chart" id="weeklyChart"></div>
                </div>
                
                <div class="history-section">
                    <div class="section-title">ğŸ“… å†å²è®°å½•</div>
                    <div class="history-list" id="historyList"></div>
                </div>
            </div>
        </div>
        
        <!-- å•†åŸé¡µé¢ -->
        <div class="page" id="shopPage" style="display: none;">
            <div class="section">
                <div class="section-title">
                    ğŸ›’ ç§¯åˆ†å•†åŸ
                </div>
                <div class="points-balance">
                    <div class="balance-card">
                        <div class="balance-title">æˆ‘çš„ç§¯åˆ†</div>
                        <div class="balance-value" id="userBalance">0</div>
                        <div class="balance-desc">å®Œæˆä»»åŠ¡è·å¾—ç§¯åˆ†</div>
                        <button class="history-btn" onclick="viewExchangeHistory()">ğŸ“‹ å…‘æ¢å†å²</button>
                    </div>
                </div>
                
                <div class="shop-categories">
                    <button class="category-btn active" onclick="filterShop('all')">å…¨éƒ¨</button>
                    <button class="category-btn" onclick="filterShop('digital')">æ•°å­—å•†å“</button>
                    <button class="category-btn" onclick="filterShop('physical')">å®ç‰©å•†å“</button>
                    <button class="category-btn" onclick="filterShop('experience')">ä½“éªŒç±»</button>
                </div>
                
                <div class="shop-items" id="shopItems"></div>
            </div>
        </div>
        
        <!-- ä¸ªäººä¸­å¿ƒé¡µé¢ -->
        <div class="page" id="profilePage" style="display: none;">
            <div class="section">
                <div class="profile-header">
                    <div class="avatar">ğŸ‘¤</div>
                    <div class="profile-info">
                        <div class="username" id="username">ç”¨æˆ·</div>
                        <div class="user-level">Lv.1 æ–°æ‰‹</div>
                    </div>
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="profileTotalTasks">0</div>
                            <div class="profile-stat-label">æ€»ä»»åŠ¡</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="profileTotalPoints">0</div>
                            <div class="profile-stat-label">æ€»ç§¯åˆ†</div>
                        </div>
                    </div>
                </div>
                
                <div class="profile-menu">
                    <div class="menu-item" onclick="showModeSwitch()">
                        <div class="menu-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
                        <div class="menu-text">å®¶é•¿æ¨¡å¼</div>
                        <div class="menu-arrow">></div>
                    </div>
                    <div class="menu-item" onclick="showSettings()">
                        <div class="menu-icon">âš™ï¸</div>
                        <div class="menu-text">è®¾ç½®</div>
                        <div class="menu-arrow">></div>
                    </div>
                    <div class="menu-item" onclick="showAchievements()">
                        <div class="menu-icon">ğŸ†</div>
                        <div class="menu-text">æˆå°±</div>
                        <div class="menu-arrow">></div>
                    </div>
                    <div class="menu-item" onclick="showHelp()">
                        <div class="menu-icon">â“</div>
                        <div class="menu-text">å¸®åŠ©</div>
                        <div class="menu-arrow">></div>
                    </div>
                    <div class="menu-item" onclick="showAbout()">
                        <div class="menu-icon">â„¹ï¸</div>
                        <div class="menu-text">å…³äº</div>
                        <div class="menu-arrow">></div>
                    </div>
                </div>
                
                <div class="profile-actions">
                    <button class="action-btn" onclick="exportData()">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
                    <button class="action-btn" onclick="clearData()">ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®</button>
                </div>
            </div>
        </div>
        
        <div style="height: 80px;"></div>
        
        <!-- å®¶é•¿ç®¡ç†é¡µé¢ -->
        <div class="page" id="parentPage">
            <div class="section">
                <div class="section-title">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å®¶é•¿ç®¡ç†ä¸­å¿ƒ</div>
                
                <!-- ç”¨æˆ·æ¨¡å¼åˆ‡æ¢ -->
                <div class="mode-switch">
                    <div class="current-mode">
                        å½“å‰æ¨¡å¼ï¼š<span id="currentModeText">å­¦ç”Ÿæ¨¡å¼</span>
                        <button class="switch-mode-btn" onclick="showModeSwitch()">åˆ‡æ¢æ¨¡å¼</button>
                    </div>
                </div>
                
                <!-- ä»»åŠ¡ç§¯åˆ†ç®¡ç† -->
                <div class="parent-section">
                    <div class="parent-section-title">ğŸ“Š ä»»åŠ¡ç§¯åˆ†ç®¡ç†</div>
                    <div class="task-points-list" id="taskPointsList">
                        <!-- åŠ¨æ€åŠ è½½ä»»åŠ¡ç§¯åˆ†è®¾ç½® -->
                    </div>
                    <button class="btn btn-primary" onclick="openTaskPointsManagement()">ç®¡ç†ä»»åŠ¡ç§¯åˆ†</button>
                </div>
                
                <!-- å­©å­æ•°æ®åˆ†æ -->
                <div class="parent-section">
                    <div class="parent-section-title">ğŸ“ˆ å­¦ä¹ æ•°æ®åˆ†æ</div>
                    <div class="data-analysis">
                        <div class="analysis-item">
                            <div class="analysis-label">æœ¬å‘¨å®Œæˆç‡</div>
                            <div class="analysis-value" id="weeklyCompletionRate">0%</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">å¹³å‡æ¯æ—¥ç§¯åˆ†</div>
                            <div class="analysis-value" id="avgDailyPoints">0</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">è¿ç»­æ‰“å¡å¤©æ•°</div>
                            <div class="analysis-value" id="streakDaysParent">0</div>
                        </div>
                    </div>
                </div>
                
                <!-- å¥–åŠ±ç³»ç»Ÿç®¡ç† -->
                <div class="parent-section">
                    <div class="parent-section-title">ğŸ å¥–åŠ±ç³»ç»Ÿ</div>
                    <div class="reward-management">
                        <button class="reward-btn" onclick="manageRewards()">è®¾ç½®å¥–åŠ±è§„åˆ™</button>
                        <button class="reward-btn" onclick="viewRewardHistory()">æŸ¥çœ‹å…‘æ¢å†å²</button>
                    </div>
                </div>
                
                <!-- è®¾ç½®é€‰é¡¹ -->
                <div class="parent-section">
                    <div class="parent-section-title">âš™ï¸ è®¾ç½®</div>
                    <div class="parent-settings">
                        <div class="setting-item" onclick="changeParentPassword()">
                            <span>ä¿®æ”¹å®¶é•¿å¯†ç </span>
                            <span class="setting-arrow">></span>
                        </div>
                        <div class="setting-item" onclick="setReminders()">
                            <span>æé†’è®¾ç½®</span>
                            <span class="setting-arrow">></span>
                        </div>
                        <div class="setting-item" onclick="exportDetailedData()">
                            <span>å¯¼å‡ºè¯¦ç»†æ•°æ®</span>
                            <span class="setting-arrow">></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¨¡å¼åˆ‡æ¢å¼¹çª— -->
        <div class="mode-switch-modal" id="modeSwitchModal">
            <div class="mode-switch-content">
                <div class="mode-switch-title">åˆ‡æ¢åˆ°å®¶é•¿æ¨¡å¼</div>
                <input type="password" class="password-input" id="parentPassword" placeholder="è¯·è¾“å…¥å®¶é•¿å¯†ç ">
                <div class="mode-switch-buttons">
                    <button class="cancel-btn" onclick="hideModeSwitch()">å–æ¶ˆ</button>
                    <button class="confirm-btn" onclick="confirmModeSwitch()">ç¡®è®¤</button>
                </div>
            </div>
        </div>

        <div class="bottom-nav">
            <button class="nav-item active" onclick="switchTab('home')">
                <div class="nav-icon">ğŸ </div>
                <div>é¦–é¡µ</div>
            </button>
            <button class="nav-item" onclick="switchTab('tasks')">
                <div class="nav-icon">ğŸ“‹</div>
                <div>ä»»åŠ¡</div>
            </button>
            <button class="nav-item" onclick="switchTab('stats')">
                <div class="nav-icon">ğŸ“Š</div>
                <div>ç»Ÿè®¡</div>
            </button>
            <button class="nav-item" onclick="switchTab('profile')">
                <div class="nav-icon">ğŸ‘¤</div>
                <div>æˆ‘çš„</div>
            </button>
            <button class="nav-item" onclick="switchTab('shop')">
                <div class="nav-icon">ğŸ›’</div>
                <div>å•†åŸ</div>
            </button>
        </div>
    </div>
    
    <!-- æ·»åŠ ä»»åŠ¡æ¨¡æ€æ¡† -->
    <div class="modal" id="addTaskModal">
        <div class="modal-content">
            <div class="modal-title">æ·»åŠ æ–°ä»»åŠ¡</div>
            
            <!-- ä»»åŠ¡æ¨¡æ¿é€‰æ‹© -->
            <div class="form-group">
                <label class="form-label">é€‰æ‹©æ¨¡æ¿</label>
                <div class="template-buttons">
                    <button class="template-btn" onclick="selectTemplate('custom')">è‡ªå®šä¹‰</button>
                    <button class="template-btn" onclick="selectTemplate('study')">å­¦ä¹ ä»»åŠ¡</button>
                    <button class="template-btn" onclick="selectTemplate('exercise')">è¿åŠ¨ä»»åŠ¡</button>
                    <button class="template-btn" onclick="selectTemplate('habit')">ä¹ æƒ¯å…»æˆ</button>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">ä»»åŠ¡åç§°</label>
                <input type="text" class="form-input" id="taskTitle" placeholder="è¯·è¾“å…¥ä»»åŠ¡åç§°">
            </div>
            
            <div class="form-group">
                <label class="form-label">ä»»åŠ¡åˆ†ç±»</label>
                <select class="form-select" id="taskCategory">
                    <option value="school">ğŸ“š å­¦ä¹ ä»»åŠ¡</option>
                    <option value="home">ğŸ  å®¶åº­ä»»åŠ¡</option>
                    <option value="temp">âš¡ ä¸´æ—¶ä»»åŠ¡</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">ä»»åŠ¡é¢‘ç‡</label>
                <select class="form-select" id="taskFrequency">
                    <option value="daily">æ¯æ—¥ä»»åŠ¡</option>
                    <option value="weekly">æ¯å‘¨ä»»åŠ¡</option>
                    <option value="weekend">å‘¨æœ«ä»»åŠ¡</option>
                    <option value="current_week">æœ¬å‘¨ä»»åŠ¡</option>
                    <option value="temporary">ä¸´æ—¶ä»»åŠ¡</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">ä¼˜å…ˆçº§</label>
                <div class="priority-buttons">
                    <button class="priority-btn" data-priority="low" onclick="selectPriority('low')">
                        <span class="priority-icon">ğŸŸ¢</span>
                        <span>ä½</span>
                    </button>
                    <button class="priority-btn active" data-priority="medium" onclick="selectPriority('medium')">
                        <span class="priority-icon">ğŸŸ¡</span>
                        <span>ä¸­</span>
                    </button>
                    <button class="priority-btn" data-priority="high" onclick="selectPriority('high')">
                        <span class="priority-icon">ğŸ”´</span>
                        <span>é«˜</span>
                    </button>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">ç§¯åˆ†å¥–åŠ±</label>
                <input type="number" class="form-input" id="taskPoints" value="10" min="1" max="100">
            </div>
            
            <div class="form-group" id="temporaryTaskGroup" style="display: none;">
                <label class="form-label">æˆªæ­¢æ—¥æœŸ</label>
                <input type="date" class="form-input" id="taskDeadline">
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="hideAddTaskModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="addTask()">æ·»åŠ </button>
            </div>
        </div>
    </div>
    
    <script>
        // åº”ç”¨çŠ¶æ€
        let totalPoints = parseInt(localStorage.getItem('totalPoints')) || 0;
        let completedTasks = JSON.parse(localStorage.getItem('completedTasks')) || [];
        let userProfile = JSON.parse(localStorage.getItem('userProfile')) || {
            name: 'å°æ˜',
            level: 1,
            avatar: 'ğŸ‘¤',
            streakDays: 0,
            totalTasks: 0,
            joinDate: new Date().toISOString()
        };
        
        // ä»»åŠ¡æ•°æ®
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [
            {
                id: 'task_1',
                title: 'å®Œæˆæ•°å­¦ä½œä¸š',
                category: 'school',
                frequency: 'daily',
                points: 20,
                completed: false,
                createdAt: new Date().toISOString(),
                createdBy: 'student'
            },
            {
                id: 'task_2',
                title: 'èƒŒè¯µè‹±è¯­å•è¯',
                category: 'school',
                frequency: 'daily',
                points: 15,
                completed: false,
                createdAt: new Date().toISOString(),
                createdBy: 'student'
            },
            {
                id: 'task_3',
                title: 'æ•´ç†æˆ¿é—´',
                category: 'home',
                frequency: 'daily',
                points: 10,
                completed: false,
                createdAt: new Date().toISOString(),
                createdBy: 'student'
            }
        ];
        
        // å½“å‰æ¨¡å¼
        let currentMode = localStorage.getItem('currentMode') || 'student';
        let parentPassword = localStorage.getItem('parentPassword') || '123456';
        
        // æˆå°±ç³»ç»Ÿæ•°æ®
        const achievements = [
            {
                id: 'first_task',
                name: 'åˆæ¥ä¹åˆ°',
                description: 'å®Œæˆç¬¬ä¸€ä¸ªä»»åŠ¡',
                icon: 'ğŸ¯',
                condition: (stats) => stats.completedTasks >= 1,
                points: 10
            },
            {
                id: 'streak_3',
                name: 'åšæŒä¸æ‡ˆ',
                description: 'è¿ç»­æ‰“å¡3å¤©',
                icon: 'ğŸ”¥',
                condition: (stats) => stats.streakDays >= 3,
                points: 20
            },
            {
                id: 'streak_7',
                name: 'ä¸€å‘¨è¾¾äºº',
                description: 'è¿ç»­æ‰“å¡7å¤©',
                icon: 'â­',
                condition: (stats) => stats.streakDays >= 7,
                points: 50
            },
            {
                id: 'points_100',
                name: 'ç§¯åˆ†æ–°æ‰‹',
                description: 'ç´¯è®¡è·å¾—100ç§¯åˆ†',
                icon: 'ğŸ’',
                condition: (stats) => stats.totalPoints >= 100,
                points: 30
            },
            {
                id: 'points_500',
                name: 'ç§¯åˆ†è¾¾äºº',
                description: 'ç´¯è®¡è·å¾—500ç§¯åˆ†',
                icon: 'ğŸ‘‘',
                condition: (stats) => stats.totalPoints >= 500,
                points: 100
            },
            {
                id: 'tasks_50',
                name: 'ä»»åŠ¡ä¸“å®¶',
                description: 'å®Œæˆ50ä¸ªä»»åŠ¡',
                icon: 'ğŸ†',
                condition: (stats) => stats.completedTasks >= 50,
                points: 80
            },
            {
                id: 'perfect_week',
                name: 'å®Œç¾ä¸€å‘¨',
                description: 'ä¸€å‘¨å†…å®Œæˆæ‰€æœ‰ä»»åŠ¡',
                icon: 'ğŸŒŸ',
                condition: (stats) => stats.weeklyCompletionRate >= 100,
                points: 150
            }
        ];
        
        // è·å–å·²è§£é”çš„æˆå°±
        function getUnlockedAchievements() {
            return JSON.parse(localStorage.getItem('unlockedAchievements')) || [];
        }
        
        // ä¿å­˜å·²è§£é”çš„æˆå°±
        function saveUnlockedAchievements(unlockedList) {
            localStorage.setItem('unlockedAchievements', JSON.stringify(unlockedList));
        }
        
        // æ£€æŸ¥å¹¶è§£é”æ–°æˆå°±
        function checkAchievements() {
            const unlockedAchievements = getUnlockedAchievements();
            const stats = {
                completedTasks: completedTasks.length,
                totalPoints: totalPoints,
                streakDays: userProfile.streakDays,
                weeklyCompletionRate: calculateWeeklyCompletionRate()
            };
            
            const newlyUnlocked = [];
            
            achievements.forEach(achievement => {
                // å¦‚æœæˆå°±æœªè§£é”ä¸”æ»¡è¶³æ¡ä»¶
                if (!unlockedAchievements.includes(achievement.id) && achievement.condition(stats)) {
                    unlockedAchievements.push(achievement.id);
                    newlyUnlocked.push(achievement);
                }
            });
            
            if (newlyUnlocked.length > 0) {
                saveUnlockedAchievements(unlockedAchievements);
                
                // æ˜¾ç¤ºæˆå°±è§£é”åŠ¨ç”»
                newlyUnlocked.forEach(achievement => {
                    showAchievementUnlock(achievement);
                    // å¥–åŠ±ç§¯åˆ†
                    totalPoints += achievement.points;
                });
                
                // ä¿å­˜æ›´æ–°åçš„ç§¯åˆ†
                localStorage.setItem('totalPoints', totalPoints.toString());
            }
        }
        
        // è®¡ç®—æœ¬å‘¨å®Œæˆç‡
        function calculateWeeklyCompletionRate() {
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());
            startOfWeek.setHours(0, 0, 0, 0);
            
            const weekTasks = getAllTasks().filter(task => {
                const taskDate = new Date(task.createdAt);
                return taskDate >= startOfWeek;
            });
            
            const completedWeekTasks = weekTasks.filter(task => task.completed);
            
            return weekTasks.length > 0 ? (completedWeekTasks.length / weekTasks.length) * 100 : 0;
        }
        
        // æ˜¾ç¤ºæˆå°±è§£é”åŠ¨ç”»
        function showAchievementUnlock(achievement) {
            // åˆ›å»ºèƒŒæ™¯é®ç½©
            const overlay = document.createElement('div');
            overlay.className = 'achievement-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 9999;
                animation: overlayFadeIn 0.5s ease-out;
            `;
            
            // åˆ›å»ºæˆå°±å¼¹çª—
            const achievementPopup = document.createElement('div');
            achievementPopup.className = 'achievement-popup';
            achievementPopup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 40px;
                border-radius: 20px;
                text-align: center;
                z-index: 10000;
                box-shadow: 0 20px 60px rgba(0,0,0,0.5);
                animation: achievementShow 4s ease-out forwards;
                max-width: 350px;
                width: 90%;
            `;
            
            // åˆ›å»ºç²’å­æ•ˆæœå®¹å™¨
            const particlesContainer = document.createElement('div');
            particlesContainer.className = 'particles-container';
            particlesContainer.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                overflow: hidden;
                border-radius: 20px;
            `;
            
            // æ·»åŠ ç²’å­æ•ˆæœ
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.style.cssText = `
                    position: absolute;
                    width: 6px;
                    height: 6px;
                    background: #ffd700;
                    border-radius: 50%;
                    animation: particleFloat ${2 + Math.random() * 2}s ease-out infinite;
                    animation-delay: ${Math.random() * 2}s;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                `;
                particlesContainer.appendChild(particle);
            }
            
            achievementPopup.innerHTML = `
                <div style="position: relative; z-index: 1;">
                    <div style="font-size: 64px; margin-bottom: 20px; animation: iconBounce 2s ease-out;">${achievement.icon}</div>
                    <h3 style="margin: 0 0 12px 0; font-size: 24px; animation: textSlideIn 1s ease-out 0.5s both;">ğŸ‰ æˆå°±è§£é”ï¼</h3>
                    <h4 style="margin: 0 0 12px 0; color: #ffd700; font-size: 18px; animation: textSlideIn 1s ease-out 0.7s both;">${achievement.name}</h4>
                    <p style="margin: 0 0 20px 0; font-size: 14px; opacity: 0.9; line-height: 1.4; animation: textSlideIn 1s ease-out 0.9s both;">${achievement.description}</p>
                    <div style="background: rgba(255,255,255,0.2); padding: 12px 20px; border-radius: 25px; display: inline-block; font-weight: bold; animation: pointsBounce 1s ease-out 1.2s both;">
                        +${achievement.points} ç§¯åˆ†
                    </div>
                </div>
            `;
            
            achievementPopup.appendChild(particlesContainer);
            document.body.appendChild(overlay);
            document.body.appendChild(achievementPopup);
            
            // 4ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (overlay.parentNode) overlay.parentNode.removeChild(overlay);
                if (achievementPopup.parentNode) achievementPopup.parentNode.removeChild(achievementPopup);
            }, 4000);
        }
        
        // æ·»åŠ æˆå°±åŠ¨ç”»CSS
        function addAchievementAnimationCSS() {
            const style = document.createElement('style');
            style.textContent = `
                @keyframes overlayFadeIn {
                    0% { opacity: 0; }
                    100% { opacity: 1; }
                }
                
                @keyframes achievementShow {
                    0% { 
                        opacity: 0; 
                        transform: translate(-50%, -50%) scale(0.3) rotateY(180deg); 
                    }
                    20% { 
                        opacity: 1; 
                        transform: translate(-50%, -50%) scale(1.2) rotateY(0deg); 
                    }
                    30% { 
                        transform: translate(-50%, -50%) scale(0.95) rotateY(0deg); 
                    }
                    40% { 
                        transform: translate(-50%, -50%) scale(1.05) rotateY(0deg); 
                    }
                    50% { 
                        transform: translate(-50%, -50%) scale(1) rotateY(0deg); 
                    }
                    85% { 
                        opacity: 1; 
                        transform: translate(-50%, -50%) scale(1) rotateY(0deg); 
                    }
                    100% { 
                        opacity: 0; 
                        transform: translate(-50%, -50%) scale(0.8) rotateY(0deg); 
                    }
                }
                
                @keyframes iconBounce {
                    0% { 
                        transform: scale(0) rotate(0deg); 
                    }
                    50% { 
                        transform: scale(1.3) rotate(180deg); 
                    }
                    70% { 
                        transform: scale(0.9) rotate(360deg); 
                    }
                    100% { 
                        transform: scale(1) rotate(360deg); 
                    }
                }
                
                @keyframes textSlideIn {
                    0% { 
                        opacity: 0; 
                        transform: translateY(20px); 
                    }
                    100% { 
                        opacity: 1; 
                        transform: translateY(0); 
                    }
                }
                
                @keyframes pointsBounce {
                    0% { 
                        opacity: 0; 
                        transform: scale(0.5) translateY(20px); 
                    }
                    50% { 
                        opacity: 1; 
                        transform: scale(1.2) translateY(0); 
                    }
                    100% { 
                        opacity: 1; 
                        transform: scale(1) translateY(0); 
                    }
                }
                
                @keyframes particleFloat {
                    0% { 
                        opacity: 0; 
                        transform: translateY(0) scale(0); 
                    }
                    20% { 
                        opacity: 1; 
                        transform: translateY(-10px) scale(1); 
                    }
                    80% { 
                        opacity: 1; 
                        transform: translateY(-30px) scale(1); 
                    }
                    100% { 
                        opacity: 0; 
                        transform: translateY(-50px) scale(0); 
                    }
                }
            `;
            document.head.appendChild(style);
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        function init() {
            loadHomePage();
            addPointsAnimationCSS();
            addAchievementAnimationCSS();
            checkAchievements(); // æ£€æŸ¥æˆå°±è§£é”
            initPermissionSystem(); // åˆå§‹åŒ–æƒé™ç³»ç»Ÿ
        }
        
        // æ·»åŠ ç§¯åˆ†åŠ¨ç”»CSS
        function addPointsAnimationCSS() {
            const style = document.createElement('style');
            style.textContent = `
                @keyframes pointsAnimation {
                    0% { opacity: 1; transform: translateY(0); }
                    100% { opacity: 0; transform: translateY(-30px); }
                }
            `;
            document.head.appendChild(style);
        }
        
        // é¡µé¢åˆ‡æ¢åŠŸèƒ½
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰å¯¼èˆªé¡¹çš„activeç±»
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„é¡µé¢
            const targetPage = document.getElementById(tabName + 'Page');
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // æ·»åŠ activeç±»åˆ°å½“å‰å¯¼èˆªé¡¹
            event.target.closest('.nav-item').classList.add('active');
            
            // æ ¹æ®é¡µé¢åŠ è½½ç›¸åº”æ•°æ®
            switch(tabName) {
                case 'home':
                    loadHomePage();
                    break;
                case 'tasks':
                    loadTasks();
                    updateTaskDisplay(); // åº”ç”¨æ™ºèƒ½è¿‡æ»¤
                    break;
                case 'stats':
                    loadStats();
                    break;
                case 'shop':
                    loadShop();
                    break;
                case 'profile':
                    loadProfile();
                    break;
            }
        }
        
        // é¦–é¡µæ•°æ®åŠ è½½
        function loadHomePage() {
            // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
            document.getElementById('userName').textContent = userProfile.name;
            document.getElementById('userLevel').textContent = `Lv.${userProfile.level} ${getLevelTitle(userProfile.level)}`;
            document.getElementById('userAvatar').textContent = userProfile.avatar;
            document.getElementById('homePoints').textContent = totalPoints;
            
            // è®¡ç®—ä»Šæ—¥è¿›åº¦
            const todayTasks = getTodayTasks();
            const completedToday = getCompletedTodayTasks();
            const progressPercent = todayTasks.length > 0 ? (completedToday.length / todayTasks.length) * 100 : 0;
            
            document.getElementById('dailyProgress').style.width = progressPercent + '%';
            document.getElementById('progressText').textContent = `${completedToday.length}/${todayTasks.length} ä»»åŠ¡å®Œæˆ`;
            
            // æ›´æ–°å¿«é€Ÿç»Ÿè®¡
            document.getElementById('quickTotalTasks').textContent = getAllTasks().length;
            document.getElementById('quickCompletedTasks').textContent = completedTasks.length;
            document.getElementById('quickStreakDays').textContent = userProfile.streakDays;
            
            // åŠ è½½æœ€æ–°æˆå°±
            loadRecentAchievements();
        }
        
        // è·å–ç­‰çº§ç§°å·
        function getLevelTitle(level) {
            if (level <= 5) return 'æ–°æ‰‹';
            if (level <= 10) return 'è¿›é˜¶è€…';
            if (level <= 20) return 'è‡ªå¾‹è¾¾äºº';
            return 'å¤§å¸ˆ';
        }
        
        // ========== æ™ºèƒ½ä»»åŠ¡è¿‡æ»¤ç³»ç»Ÿ ==========
        
        // è·å–ä»Šæ—¥ä»»åŠ¡ï¼ˆæ™ºèƒ½è¿‡æ»¤ï¼‰
        function getTodayTasks() {
            const today = new Date();
            const dayOfWeek = today.getDay(); // 0=å‘¨æ—¥, 1=å‘¨ä¸€, ..., 6=å‘¨å…­
            
            return tasks.filter(task => {
                // æ¯æ—¥ä»»åŠ¡
                if (task.frequency === 'daily') return true;
                
                // å·¥ä½œæ—¥ä»»åŠ¡ï¼ˆå‘¨ä¸€åˆ°å‘¨äº”ï¼‰
                if (task.frequency === 'weekdays' && dayOfWeek >= 1 && dayOfWeek <= 5) return true;
                
                // å‘¨æœ«ä»»åŠ¡ï¼ˆå‘¨å…­å’Œå‘¨æ—¥ï¼‰
                if (task.frequency === 'weekends' && (dayOfWeek === 0 || dayOfWeek === 6)) return true;
                
                // ç‰¹å®šæ˜ŸæœŸå‡ çš„ä»»åŠ¡
                if (task.frequency === 'weekly' && task.weekDay === dayOfWeek) return true;
                
                return false;
            });
        }
        
        // è·å–ä»Šæ—¥å·²å®Œæˆä»»åŠ¡
        function getCompletedTodayTasks() {
            const today = new Date().toDateString();
            return completedTasks.filter(task => {
                const taskDate = new Date(task.completedAt || task.date).toDateString();
                return taskDate === today;
            });
        }
        
        // è·å–æ‰€æœ‰ä»»åŠ¡
        function getAllTasks() {
            return tasks;
        }
        
        // ä»»åŠ¡è¿‡æ»¤åŠŸèƒ½
        function filterTasks(category = 'all') {
            const taskList = document.getElementById('taskList');
            if (!taskList) return;
            
            let filteredTasks = tasks;
            
            if (category !== 'all') {
                filteredTasks = tasks.filter(task => task.category === category);
            }
            
            // é‡æ–°æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨
            renderTaskList(filteredTasks);
        }
        
        // æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨
        function renderTaskList(taskList = tasks) {
            const container = document.getElementById('taskList');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (taskList.length === 0) {
                container.innerHTML = '<div class="empty-state">æš‚æ— ä»»åŠ¡</div>';
                return;
            }
            
            taskList.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.className = `task-item ${task.completed ? 'completed' : ''}`;
                taskItem.innerHTML = `
                    <div class="task-content">
                        <div class="task-icon">${getTaskTypeIcon(task.category)}</div>
                        <div class="task-info">
                            <div class="task-title">${task.title}</div>
                            <div class="task-meta">
                                ${getTaskTypeName(task.category)} â€¢ ${task.points} ç§¯åˆ†
                            </div>
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="btn-complete" onclick="toggleTask('${task.id}')" 
                                ${task.completed ? 'disabled' : ''}>
                            ${task.completed ? 'âœ…' : 'â­•'}
                        </button>
                    </div>
                `;
                container.appendChild(taskItem);
            });
        }
        
        // åˆ‡æ¢ä»»åŠ¡å®ŒæˆçŠ¶æ€
        function toggleTask(taskId) {
            const task = tasks.find(t => t.id == taskId);
            if (!task) return;
            
            // å¦‚æœä»»åŠ¡å·²å®Œæˆï¼Œä¸å…è®¸é‡å¤å®Œæˆ
            if (task.completed) {
                showToast('è¯¥ä»»åŠ¡å·²ç»å®Œæˆäº†ï¼');
                return;
            }
            
            // æ ‡è®°ä»»åŠ¡ä¸ºå®Œæˆ
            task.completed = true;
            task.completedAt = new Date().toISOString();
            
            // æ·»åŠ åˆ°å·²å®Œæˆä»»åŠ¡åˆ—è¡¨
            const completedTask = {
                id: taskId,
                title: task.title,
                category: task.category || task.type,
                points: task.points,
                completedAt: task.completedAt,
                date: new Date().toISOString(),
                priority: task.priority || 'medium'
            };
            completedTasks.push(completedTask);
            
            // å¢åŠ ç§¯åˆ†
            totalPoints += task.points;
            
            // æ˜¾ç¤ºå®ŒæˆåŠ¨ç”»
            showTaskCompleteAnimation(task);
            
            // ä¿å­˜æ•°æ®
            localStorage.setItem('tasks', JSON.stringify(tasks));
            localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
            localStorage.setItem('totalPoints', totalPoints.toString());
            
            // æ£€æŸ¥æˆå°±
            checkAchievements();
            
            // æ›´æ–°æ˜¾ç¤º
            const currentPage = document.querySelector('.page[style*="block"]');
            if (currentPage && currentPage.id === 'homePage') {
                loadHomePage();
            } else if (currentPage && currentPage.id === 'tasksPage') {
                renderTaskList();
            }
            
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            showToast(`ğŸ‰ å®Œæˆä»»åŠ¡"${task.title}"ï¼Œè·å¾—${task.points}ç§¯åˆ†ï¼`);
        }
        
        // æ˜¾ç¤ºä»»åŠ¡å®ŒæˆåŠ¨ç”»
        function showTaskCompleteAnimation(task) {
            const popup = document.createElement('div');
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #28a745, #20c997);
                color: white;
                padding: 20px 30px;
                border-radius: 15px;
                text-align: center;
                box-shadow: 0 10px 30px rgba(40, 167, 69, 0.3);
                z-index: 10000;
                animation: taskCompleteShow 2s ease-out forwards;
            `;
            
            popup.innerHTML = `
                <div style="font-size: 32px; margin-bottom: 10px;">ğŸ‰</div>
                <h3 style="margin: 0 0 8px 0;">ä»»åŠ¡å®Œæˆï¼</h3>
                <p style="margin: 0; opacity: 0.9;">è·å¾— ${task.points} ç§¯åˆ†</p>
            `;
            
            document.body.appendChild(popup);
            
            // æ·»åŠ åŠ¨ç”»æ ·å¼
            if (!document.getElementById('taskCompleteAnimation')) {
                const style = document.createElement('style');
                style.id = 'taskCompleteAnimation';
                style.textContent = `
                    @keyframes taskCompleteShow {
                        0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                        50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                        100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.parentNode.removeChild(popup);
                }
            }, 2000);
        }
        
        // åŠ è½½æœ€æ–°æˆå°±
        function loadRecentAchievements() {
            const container = document.getElementById('recentAchievements');
            if (!container) return;
            
            const unlockedAchievements = getUnlockedAchievements();
            const recentAchievements = unlockedAchievements.slice(-3); // æœ€è¿‘3ä¸ªæˆå°±
            
            if (recentAchievements.length === 0) {
                container.innerHTML = '<div class="empty-state">æš‚æ— æˆå°±</div>';
                return;
            }
            
            container.innerHTML = '';
            recentAchievements.forEach(achievement => {
                const achievementItem = document.createElement('div');
                achievementItem.className = 'achievement-item';
                achievementItem.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-info">
                        <div class="achievement-name">${achievement.name}</div>
                        <div class="achievement-desc">${achievement.description}</div>
                    </div>
                `;
                container.appendChild(achievementItem);
            });
        }
        
        // åŠ è½½ä»»åŠ¡é¡µé¢
        function loadTasks() {
            renderTaskList();
            updateTaskStats();
        }
        
        // æ›´æ–°ä»»åŠ¡ç»Ÿè®¡
        function updateTaskStats() {
            const todayTasks = getTodayTasks();
            const completedToday = getCompletedTodayTasks();
            
            // æ›´æ–°ä»»åŠ¡åˆ†ç±»æŒ‰é’®çš„æ•°é‡æ˜¾ç¤º
            const schoolTasks = tasks.filter(t => t.category === 'school').length;
            const homeTasks = tasks.filter(t => t.category === 'home').length;
            const tempTasks = tasks.filter(t => t.category === 'temp').length;
            
            // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šç»Ÿè®¡ä¿¡æ¯çš„æ›´æ–°
        }
        
        // æ›´æ–°ä»»åŠ¡æ˜¾ç¤ºï¼ˆåº”ç”¨æ™ºèƒ½è¿‡æ»¤ï¼‰
        function updateTaskDisplay() {
            const todayTasks = getTodayTasks();
            renderTaskList(todayTasks);
        }
        
        // åŠ è½½ç»Ÿè®¡é¡µé¢
        function loadStats() {
            // æ›´æ–°æœ¬å‘¨å®Œæˆç‡
            const weeklyRate = calculateWeeklyCompletionRate();
            const weeklyElement = document.getElementById('weeklyCompletionRate');
            if (weeklyElement) {
                weeklyElement.textContent = weeklyRate + '%';
            }
            
            // æ›´æ–°è¿ç»­å¤©æ•°
            const streakElement = document.getElementById('streakDays');
            if (streakElement) {
                streakElement.textContent = userProfile.streakDays;
            }
            
            // æ›´æ–°7å¤©å®Œæˆå›¾è¡¨
            updateWeeklyChart();
        }
        
        // æ›´æ–°7å¤©å®Œæˆå›¾è¡¨
        function updateWeeklyChart() {
            const chartContainer = document.getElementById('weeklyChart');
            if (!chartContainer) return;
            
            chartContainer.innerHTML = '';
            
            // ç”Ÿæˆæœ€è¿‘7å¤©çš„æ•°æ®
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();
                
                const dayTasks = completedTasks.filter(task => {
                    const taskDate = new Date(task.completedAt || task.date).toDateString();
                    return taskDate === dateStr;
                }).length;
                
                const dayElement = document.createElement('div');
                dayElement.className = 'chart-day';
                dayElement.innerHTML = `
                    <div class="chart-bar" style="height: ${Math.max(dayTasks * 20, 5)}px;"></div>
                    <div class="chart-label">${date.getDate()}</div>
                `;
                chartContainer.appendChild(dayElement);
            }
        }
        
        // åŠ è½½å•†åŸé¡µé¢
        function loadShop() {
            renderShopItems();
            updateShopPoints();
        }
        
        // å•†åŸç‰©å“æ•°æ®
        const shopItems = [
            // æ•°å­—å•†å“
            { id: 'digital_1', name: 'æ¸¸æˆæ—¶é—´30åˆ†é’Ÿ', price: 30, category: 'digital', icon: 'ğŸ®', description: 'é¢å¤–è·å¾—30åˆ†é’Ÿæ¸¸æˆæ—¶é—´' },
            { id: 'digital_2', name: 'çœ‹åŠ¨ç”»ç‰‡1å°æ—¶', price: 50, category: 'digital', icon: 'ğŸ“º', description: 'å¯ä»¥çœ‹1å°æ—¶å–œæ¬¢çš„åŠ¨ç”»ç‰‡' },
            { id: 'digital_3', name: 'æ‰‹æœºä½¿ç”¨æ—¶é—´', price: 40, category: 'digital', icon: 'ğŸ“±', description: 'é¢å¤–è·å¾—30åˆ†é’Ÿæ‰‹æœºä½¿ç”¨æ—¶é—´' },
            
            // å®ç‰©å•†å“
            { id: 'physical_1', name: 'å°é›¶é£Ÿ', price: 20, category: 'physical', icon: 'ğŸª', description: 'é€‰æ‹©ä¸€æ ·å–œæ¬¢çš„å°é›¶é£Ÿ' },
            { id: 'physical_2', name: 'æ–‡å…·ç”¨å“', price: 60, category: 'physical', icon: 'âœï¸', description: 'è´­ä¹°ä¸€ä»¶å­¦ä¹ æ–‡å…·' },
            { id: 'physical_3', name: 'å°ç©å…·', price: 80, category: 'physical', icon: 'ğŸ§¸', description: 'é€‰æ‹©ä¸€ä¸ªå¿ƒä»ªçš„å°ç©å…·' },
            { id: 'physical_4', name: 'æ–°ä¹¦ç±', price: 100, category: 'physical', icon: 'ğŸ“š', description: 'è´­ä¹°ä¸€æœ¬å–œæ¬¢çš„è¯¾å¤–ä¹¦' },
            
            // ä½“éªŒç±»
            { id: 'experience_1', name: 'å‘¨æœ«ç”µå½±é™¢', price: 150, category: 'experience', icon: 'ğŸ¬', description: 'å’Œå®¶äººä¸€èµ·å»ç”µå½±é™¢çœ‹ç”µå½±' },
            { id: 'experience_2', name: 'æ¸¸ä¹å›­é—¨ç¥¨', price: 200, category: 'experience', icon: 'ğŸ¡', description: 'è·å¾—æ¸¸ä¹å›­é—¨ç¥¨ä¸€å¼ ' },
            { id: 'experience_3', name: 'å¤–å‡ºå°±é¤', price: 120, category: 'experience', icon: 'ğŸ½ï¸', description: 'é€‰æ‹©å–œæ¬¢çš„é¤å…å¤–å‡ºå°±é¤' },
            { id: 'experience_4', name: 'å‘¨æœ«éƒŠæ¸¸', price: 180, category: 'experience', icon: 'ğŸï¸', description: 'å’Œå®¶äººä¸€èµ·å‘¨æœ«éƒŠæ¸¸' },
            { id: 'experience_5', name: 'å…åšå®¶åŠ¡ä¸€å¤©', price: 90, category: 'experience', icon: 'ğŸ ', description: 'å…é™¤ä¸€å¤©çš„å®¶åŠ¡ä»»åŠ¡' }
        ];
        
        // å½“å‰é€‰ä¸­çš„å•†åŸåˆ†ç±»
        let currentShopCategory = 'all';
        
        // æ¸²æŸ“å•†åŸç‰©å“
        function renderShopItems(category = 'all') {
            const container = document.getElementById('shopItems');
            if (!container) return;
            
            // æ ¹æ®åˆ†ç±»ç­›é€‰å•†å“
            let filteredItems = shopItems;
            if (category !== 'all') {
                filteredItems = shopItems.filter(item => item.category === category);
            }
            
            container.innerHTML = '';
            
            if (filteredItems.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ›’</div>
                        <p>è¯¥åˆ†ç±»æš‚æ— å•†å“</p>
                    </div>
                `;
                return;
            }
            
            filteredItems.forEach(item => {
                const canAfford = totalPoints >= item.price;
                const itemElement = document.createElement('div');
                itemElement.className = `shop-item ${!canAfford ? 'disabled' : ''}`;
                itemElement.innerHTML = `
                    <div class="shop-item-icon">${item.icon}</div>
                    <div class="shop-item-content">
                        <div class="shop-item-name">${item.name}</div>
                        <div class="shop-item-desc">${item.description}</div>
                        <div class="shop-item-price">${item.price} ç§¯åˆ†</div>
                    </div>
                    <button class="btn-buy ${!canAfford ? 'disabled' : ''}" 
                            onclick="buyItem('${item.id}', '${item.name}', ${item.price})"
                            ${!canAfford ? 'disabled' : ''}>
                        ${!canAfford ? 'ç§¯åˆ†ä¸è¶³' : 'å…‘æ¢'}
                    </button>
                `;
                container.appendChild(itemElement);
            });
        }
        
        // è´­ä¹°ç‰©å“
        function buyItem(itemId, itemName, price) {
            if (totalPoints < price) {
                showToast('âŒ ç§¯åˆ†ä¸è¶³ï¼');
                return;
            }
            
            // ç¡®è®¤è´­ä¹°
            if (!confirm(`ç¡®å®šè¦ç”¨ ${price} ç§¯åˆ†å…‘æ¢"${itemName}"å—ï¼Ÿ`)) {
                return;
            }
            
            // æ‰£é™¤ç§¯åˆ†
            totalPoints -= price;
            localStorage.setItem('totalPoints', totalPoints.toString());
            
            // è®°å½•å…‘æ¢å†å²
            const exchanges = JSON.parse(localStorage.getItem('exchanges') || '[]');
            const exchange = {
                id: 'exchange_' + Date.now(),
                itemId: itemId,
                itemName: itemName,
                price: price,
                date: new Date().toISOString(),
                status: 'pending' // pending, completed, cancelled
            };
            exchanges.push(exchange);
            localStorage.setItem('exchanges', JSON.stringify(exchanges));
            
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            showToast(`ğŸ‰ å…‘æ¢æˆåŠŸï¼å·²æ‰£é™¤ ${price} ç§¯åˆ†`);
            
            // é‡æ–°åŠ è½½å•†åŸå’Œæ›´æ–°ç§¯åˆ†æ˜¾ç¤º
            loadShop();
            
            // å¦‚æœåœ¨é¦–é¡µï¼Œæ›´æ–°ç§¯åˆ†æ˜¾ç¤º
            const currentPage = document.querySelector('.page[style*="block"]');
            if (currentPage && currentPage.id === 'homePage') {
                loadHomePage();
            }
        }
        
        // å•†åŸåˆ†ç±»ç­›é€‰
        function filterShop(category) {
            currentShopCategory = category;
            
            // æ›´æ–°åˆ†ç±»æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // é‡æ–°æ¸²æŸ“å•†å“
            renderShopItems(category);
        }
        
        // æ›´æ–°å•†åŸç§¯åˆ†æ˜¾ç¤º
        function updateShopPoints() {
            const balanceElement = document.getElementById('userBalance');
            if (balanceElement) {
                balanceElement.textContent = totalPoints;
            }
        }
        
        // æŸ¥çœ‹å…‘æ¢å†å²
        function viewExchangeHistory() {
            const exchanges = JSON.parse(localStorage.getItem('exchanges') || '[]');
            
            if (exchanges.length === 0) {
                showToast('æš‚æ— å…‘æ¢è®°å½•');
                return;
            }
            
            let historyHtml = '<div class="exchange-history-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;">';
            historyHtml += '<div style="background: white; border-radius: 15px; padding: 20px; max-width: 90%; max-height: 80%; overflow-y: auto;">';
            historyHtml += '<h3 style="margin: 0 0 15px 0; text-align: center;">å…‘æ¢å†å²</h3>';
            
            exchanges.reverse().forEach(exchange => {
                const date = new Date(exchange.date).toLocaleDateString('zh-CN');
                const statusText = exchange.status === 'pending' ? 'å¾…å¤„ç†' : exchange.status === 'completed' ? 'å·²å®Œæˆ' : 'å·²å–æ¶ˆ';
                const statusColor = exchange.status === 'pending' ? '#f39c12' : exchange.status === 'completed' ? '#27ae60' : '#e74c3c';
                
                historyHtml += `
                    <div style="border: 1px solid #eee; border-radius: 8px; padding: 12px; margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: bold;">${exchange.itemName}</div>
                                <div style="color: #666; font-size: 12px;">${date}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: #e74c3c; font-weight: bold;">-${exchange.price} ç§¯åˆ†</div>
                                <div style="color: ${statusColor}; font-size: 12px;">${statusText}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            historyHtml += '<button onclick="closeExchangeHistory()" style="width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 8px; margin-top: 15px;">å…³é—­</button>';
            historyHtml += '</div></div>';
            
            document.body.insertAdjacentHTML('beforeend', historyHtml);
        }
        
        // å…³é—­å…‘æ¢å†å²å¼¹çª—
        function closeExchangeHistory() {
            const modal = document.querySelector('.exchange-history-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // åŠ è½½ä¸ªäººä¸­å¿ƒ
        function loadProfile() {
            // æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
            const nameElement = document.getElementById('profileName');
            const levelElement = document.getElementById('profileLevel');
            const pointsElement = document.getElementById('profilePoints');
            const avatarElement = document.getElementById('profileAvatar');
            
            if (nameElement) nameElement.textContent = userProfile.name;
            if (levelElement) levelElement.textContent = `Lv.${userProfile.level} ${getLevelTitle(userProfile.level)}`;
            if (pointsElement) pointsElement.textContent = totalPoints;
            if (avatarElement) avatarElement.textContent = userProfile.avatar;
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            const totalTasksElement = document.getElementById('profileTotalTasks');
            const completedTasksElement = document.getElementById('profileCompletedTasks');
            const streakDaysElement = document.getElementById('profileStreakDays');
            
            if (totalTasksElement) totalTasksElement.textContent = getAllTasks().length;
            if (completedTasksElement) completedTasksElement.textContent = completedTasks.length;
            if (streakDaysElement) streakDaysElement.textContent = userProfile.streakDays;
        }
        
        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 12px 24px;
                border-radius: 25px;
                z-index: 10000;
                font-size: 14px;
                animation: toastShow 3s ease-out forwards;
            `;
            toast.textContent = message;
            
            // æ·»åŠ åŠ¨ç”»æ ·å¼
            if (!document.getElementById('toastAnimation')) {
                const style = document.createElement('style');
                style.id = 'toastAnimation';
                style.textContent = `
                    @keyframes toastShow {
                        0% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
                        10%, 90% { opacity: 1; transform: translateX(-50%) translateY(0); }
                        100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 3000);
        }
        
        // è·å–ä»»åŠ¡ç±»å‹å›¾æ ‡
        function getTaskTypeIcon(category) {
            const icons = {
                'school': 'ğŸ“š',
                'home': 'ğŸ ',
                'temp': 'â°',
                'daily': 'ğŸ“…',
                'weekly': 'ğŸ“†',
                'weekdays': 'ğŸ“',
                'weekends': 'ğŸ®'
            };
            return icons[category] || 'ğŸ“‹';
        }
        
        // è·å–ä»»åŠ¡ç±»å‹åç§°
        function getTaskTypeName(category) {
            const names = {
                'school': 'å­¦æ ¡ä»»åŠ¡',
                'home': 'å®¶åº­ä»»åŠ¡',
                'temp': 'ä¸´æ—¶ä»»åŠ¡',
                'daily': 'æ¯æ—¥ä»»åŠ¡',
                'weekly': 'æ¯å‘¨ä»»åŠ¡',
                'weekdays': 'å·¥ä½œæ—¥ä»»åŠ¡',
                'weekends': 'å‘¨æœ«ä»»åŠ¡'
            };
            return names[category] || 'å…¶ä»–ä»»åŠ¡';
        }
        
        // æ·»åŠ ä»»åŠ¡æ¨¡æ€æ¡†åŠŸèƒ½
        function showAddTaskModal() {
            const modal = document.getElementById('addTaskModal');
            if (modal) {
                modal.style.display = 'flex';
                // æ¸…ç©ºè¡¨å•
                document.getElementById('taskName').value = '';
                document.getElementById('taskType').value = 'school';
                document.getElementById('taskPoints').value = '10';
            }
        }
        
        function hideAddTaskModal() {
            const modal = document.getElementById('addTaskModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        

        
        // æƒé™ç³»ç»Ÿç›¸å…³å˜é‡
        let currentUserMode = localStorage.getItem('currentUserMode') || 'student';
        
        // æ›´æ–°ç”¨æˆ·æ¨¡å¼æ˜¾ç¤º
        function updateUserModeDisplay() {
            const modeIndicator = document.getElementById('currentModeIndicator');
            if (modeIndicator) {
                modeIndicator.textContent = currentUserMode === 'parent' ? 'å®¶é•¿æ¨¡å¼' : 'å­¦ç”Ÿæ¨¡å¼';
                modeIndicator.style.color = currentUserMode === 'parent' ? '#dc3545' : '#007bff';
            }
        }
        
        // æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢å¯¹è¯æ¡†
        function showModeSwitch() {
            const modal = document.getElementById('modeSwitchModal');
            if (modal) {
                modal.style.display = 'flex';
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }
        
        // éšè—æ¨¡å¼åˆ‡æ¢å¯¹è¯æ¡†
        function hideModeSwitch() {
            const modal = document.getElementById('modeSwitchModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // ç¡®è®¤æ¨¡å¼åˆ‡æ¢
        function confirmModeSwitch() {
            const password = document.getElementById('passwordInput').value;
            
            if (currentUserMode === 'student') {
                // ä»å­¦ç”Ÿæ¨¡å¼åˆ‡æ¢åˆ°å®¶é•¿æ¨¡å¼
                if (password === parentPassword) {
                    currentUserMode = 'parent';
                    localStorage.setItem('currentUserMode', currentUserMode);
                    updateUserModeDisplay();
                    updateUIForUserMode();
                    hideModeSwitch();
                    showToast('å·²åˆ‡æ¢åˆ°å®¶é•¿æ¨¡å¼');
                } else {
                    showToast('å¯†ç é”™è¯¯ï¼');
                    return;
                }
            } else {
                // ä»å®¶é•¿æ¨¡å¼åˆ‡æ¢åˆ°å­¦ç”Ÿæ¨¡å¼ï¼ˆæ— éœ€å¯†ç ï¼‰
                currentUserMode = 'student';
                localStorage.setItem('currentUserMode', currentUserMode);
                updateUserModeDisplay();
                updateUIForUserMode();
                hideModeSwitch();
                showToast('å·²åˆ‡æ¢åˆ°å­¦ç”Ÿæ¨¡å¼');
            }
        }
        
        // æ ¹æ®ç”¨æˆ·æ¨¡å¼æ›´æ–°UI
        function updateUIForUserMode() {
            const parentModeBtn = document.querySelector('[onclick="showModeSwitch()"]');
            const addTaskBtn = document.querySelector('.add-task-btn');
            
            if (currentUserMode === 'parent') {
                // å®¶é•¿æ¨¡å¼ï¼šæ˜¾ç¤ºå®¶é•¿é¡µé¢ï¼Œéšè—å…¶ä»–é¡µé¢
                document.querySelectorAll('.page').forEach(page => {
                    page.style.display = 'none';
                });
                
                const parentPage = document.getElementById('parentPage');
                if (parentPage) {
                    parentPage.style.display = 'block';
                    parentPage.classList.add('active');
                    loadParentPage();
                }
                
                // éšè—åº•éƒ¨å¯¼èˆª
                const bottomNav = document.querySelector('.bottom-nav');
                if (bottomNav) {
                    bottomNav.style.display = 'none';
                }
                
                // æ›´æ–°æŒ‰é’®æ–‡æœ¬
                if (parentModeBtn) {
                    parentModeBtn.textContent = 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ åˆ‡æ¢åˆ°å­¦ç”Ÿæ¨¡å¼';
                }
            } else {
                // å­¦ç”Ÿæ¨¡å¼ï¼šæ˜¾ç¤ºæ­£å¸¸é¡µé¢
                const parentPage = document.getElementById('parentPage');
                if (parentPage) {
                    parentPage.style.display = 'none';
                    parentPage.classList.remove('active');
                }
                
                // æ˜¾ç¤ºé¦–é¡µ
                document.querySelectorAll('.page').forEach(page => {
                    page.style.display = 'none';
                });
                
                const homePage = document.getElementById('homePage');
                if (homePage) {
                    homePage.style.display = 'block';
                    homePage.classList.add('active');
                    loadHomePage();
                }
                
                // æ˜¾ç¤ºåº•éƒ¨å¯¼èˆª
                const bottomNav = document.querySelector('.bottom-nav');
                if (bottomNav) {
                    bottomNav.style.display = 'flex';
                }
                
                // æ›´æ–°æŒ‰é’®æ–‡æœ¬
                if (parentModeBtn) {
                    parentModeBtn.textContent = 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å®¶é•¿æ¨¡å¼';
                }
            }
        }
        
        // åŠ è½½å®¶é•¿é¡µé¢æ•°æ®
        function loadParentPage() {
            // æ›´æ–°æœ¬å‘¨å®Œæˆç‡
            const weeklyRate = calculateWeeklyCompletionRate();
            const weeklyElement = document.getElementById('weeklyCompletionRateParent');
            if (weeklyElement) {
                weeklyElement.textContent = weeklyRate + '%';
            }
            
            // è®¡ç®—å¹³å‡æ¯æ—¥ç§¯åˆ†
            const avgPoints = calculateAverageDailyPoints();
            const avgElement = document.getElementById('avgDailyPoints');
            if (avgElement) {
                avgElement.textContent = avgPoints;
            }
            
            // æ›´æ–°è¿ç»­æ‰“å¡å¤©æ•°
            const streakElement = document.getElementById('streakDaysParent');
            if (streakElement) {
                streakElement.textContent = userProfile.streakDays;
            }
            
            // åŠ è½½ä»»åŠ¡ç§¯åˆ†åˆ—è¡¨
            loadTaskPointsList();
        }
                // æ ‡è®°å®Œæˆ
                button.classList.add('completed');
                button.textContent = 'âœ…';
                totalPoints += points;
                
                // æ·»åŠ åˆ°å·²å®Œæˆä»»åŠ¡
                if (!completedTasks.includes(taskName)) {
                    completedTasks.push(taskName);
                }
                
                // æ˜¾ç¤ºå®ŒæˆåŠ¨ç”»
                showTaskCompleteAnimation(taskItem, points);
            }
            
            // ä¿å­˜æ•°æ®
            localStorage.setItem('totalPoints', totalPoints);
            localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
            
            // æ£€æŸ¥æˆå°±è§£é”
            checkAchievements();
            
            // æ›´æ–°é¦–é¡µæ•°æ®
            if (document.getElementById('homePage').classList.contains('active')) {
                loadHomePage();
            }
        }
        
        // æ˜¾ç¤ºä»»åŠ¡å®ŒæˆåŠ¨ç”»
        }
        
        // æ¸²æŸ“ä¸ªäººä¸­å¿ƒé¡µé¢
        function renderProfilePage() {
            const totalTasks = tasks.length;
            const totalPoints = tasks.filter(task => task.completed).reduce((sum, task) => sum + task.points, 0);
            
            document.getElementById('profileTotalTasks').textContent = totalTasks;
            document.getElementById('profileTotalPoints').textContent = totalPoints;
        }
        
        // ä¸ªäººä¸­å¿ƒèœå•åŠŸèƒ½
        function showSettings() {
            showToast('âš™ï¸ è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...');
        }
        
        // ä»»åŠ¡æ¨¡æ¿æ•°æ®
        const taskTemplates = {
            study: [
                { title: 'å®Œæˆæ•°å­¦ä½œä¸š', category: 'school', frequency: 'daily', points: 20, priority: 'high' },
                { title: 'èƒŒè¯µè‹±è¯­å•è¯', category: 'school', frequency: 'daily', points: 15, priority: 'medium' },
                { title: 'å¤ä¹ ä»Šæ—¥è¯¾ç¨‹', category: 'school', frequency: 'daily', points: 18, priority: 'high' },
                { title: 'é¢„ä¹ æ˜æ—¥è¯¾ç¨‹', category: 'school', frequency: 'daily', points: 15, priority: 'medium' }
            ],
            exercise: [
                { title: 'æ™¨è·‘30åˆ†é’Ÿ', category: 'temp', frequency: 'daily', points: 25, priority: 'medium' },
                { title: 'åšä¿¯å§æ’‘20ä¸ª', category: 'temp', frequency: 'daily', points: 15, priority: 'low' },
                { title: 'è·³ç»³500ä¸‹', category: 'temp', frequency: 'daily', points: 20, priority: 'medium' },
                { title: 'æˆ·å¤–è¿åŠ¨1å°æ—¶', category: 'temp', frequency: 'weekend', points: 30, priority: 'medium' }
            ],
            habit: [
                { title: 'æ•´ç†æˆ¿é—´', category: 'home', frequency: 'daily', points: 10, priority: 'low' },
                { title: 'å¸®å¿™æ´—ç¢—', category: 'home', frequency: 'daily', points: 8, priority: 'low' },
                { title: 'æ—©ç¡æ—©èµ·', category: 'temp', frequency: 'daily', points: 15, priority: 'medium' },
                { title: 'é˜…è¯»30åˆ†é’Ÿ', category: 'temp', frequency: 'daily', points: 20, priority: 'medium' }
            ]
        };
        
        // å½“å‰é€‰æ‹©çš„ä¼˜å…ˆçº§
        let selectedPriority = 'medium';
        
        // é€‰æ‹©ä»»åŠ¡æ¨¡æ¿
        function selectTemplate(templateType) {
            // æ›´æ–°æ¨¡æ¿æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.template-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (templateType === 'custom') {
                // æ¸…ç©ºè¡¨å•
                document.getElementById('taskTitle').value = '';
                document.getElementById('taskCategory').value = 'school';
                document.getElementById('taskFrequency').value = 'daily';
                document.getElementById('taskPoints').value = '10';
                return;
            }
            
            // éšæœºé€‰æ‹©ä¸€ä¸ªæ¨¡æ¿
            const templates = taskTemplates[templateType];
            if (templates && templates.length > 0) {
                const randomTemplate = templates[Math.floor(Math.random() * templates.length)];
                
                document.getElementById('taskTitle').value = randomTemplate.title;
                document.getElementById('taskCategory').value = randomTemplate.category;
                document.getElementById('taskFrequency').value = randomTemplate.frequency;
                document.getElementById('taskPoints').value = randomTemplate.points;
                
                // è®¾ç½®ä¼˜å…ˆçº§
                selectPriority(randomTemplate.priority);
            }
        }
        
        // é€‰æ‹©ä¼˜å…ˆçº§
        function selectPriority(priority) {
            selectedPriority = priority;
            
            // æ›´æ–°ä¼˜å…ˆçº§æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.priority-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const priorityBtn = document.querySelector(`[data-priority="${priority}"]`);
            if (priorityBtn) {
                priorityBtn.classList.add('active');
            }
        }
        
        // å¢å¼ºçš„æ·»åŠ ä»»åŠ¡å‡½æ•°
        function addTask() {
            const title = document.getElementById('taskTitle').value.trim();
            const category = document.getElementById('taskCategory').value;
            const frequency = document.getElementById('taskFrequency').value;
            const points = parseInt(document.getElementById('taskPoints').value);
            const deadline = document.getElementById('taskDeadline').value;
            
            if (!title) {
                showToast('âŒ è¯·è¾“å…¥ä»»åŠ¡åç§°');
                return;
            }
            
            if (points < 1 || points > 100) {
                showToast('âŒ ç§¯åˆ†å¿…é¡»åœ¨1-100ä¹‹é—´');
                return;
            }
            
            // æ£€æŸ¥ä¸´æ—¶ä»»åŠ¡æ˜¯å¦è®¾ç½®äº†æˆªæ­¢æ—¥æœŸ
            if (frequency === 'temporary' && !deadline) {
                showToast('âŒ ä¸´æ—¶ä»»åŠ¡éœ€è¦è®¾ç½®æˆªæ­¢æ—¥æœŸ');
                return;
            }
            
            const newTask = {
                id: 'task_' + Date.now(),
                title: title,
                category: category,
                frequency: frequency,
                points: points,
                priority: selectedPriority,
                completed: false,
                createdAt: new Date().toISOString(),
                createdBy: currentMode,
                deadline: deadline || null
            };
            
            tasks.push(newTask);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            hideAddTaskModal();
            loadTasks();
            showToast('âœ… ä»»åŠ¡æ·»åŠ æˆåŠŸï¼');
        }
        
        // æ˜¾ç¤ºæ·»åŠ ä»»åŠ¡æ¨¡æ€æ¡†
        function showAddTaskModal() {
            // é‡ç½®è¡¨å•
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskCategory').value = 'school';
            document.getElementById('taskFrequency').value = 'daily';
            document.getElementById('taskPoints').value = '10';
            document.getElementById('taskDeadline').value = '';
            
            // é‡ç½®æ¨¡æ¿é€‰æ‹©
            document.querySelectorAll('.template-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.template-btn').classList.add('active');
            
            // é‡ç½®ä¼˜å…ˆçº§é€‰æ‹©
            selectPriority('medium');
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            document.getElementById('addTaskModal').style.display = 'block';
            
            // ç›‘å¬é¢‘ç‡å˜åŒ–ï¼Œæ˜¾ç¤º/éšè—æˆªæ­¢æ—¥æœŸ
            document.getElementById('taskFrequency').addEventListener('change', function() {
                const temporaryGroup = document.getElementById('temporaryTaskGroup');
                if (this.value === 'temporary') {
                    temporaryGroup.style.display = 'block';
                } else {
                    temporaryGroup.style.display = 'none';
                }
            });
        }
        
        // éšè—æ·»åŠ ä»»åŠ¡æ¨¡æ€æ¡†
        function hideAddTaskModal() {
            document.getElementById('addTaskModal').style.display = 'none';
        }
        
        // å¢å¼ºçš„ä»»åŠ¡æ¸²æŸ“å‡½æ•°
        function renderTaskList(tasksToRender) {
            const taskList = document.querySelector('.task-list');
            taskList.innerHTML = '';
            
            if (tasksToRender.length === 0) {
                taskList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“</div>
                        <p>æš‚æ— ä»»åŠ¡</p>
                    </div>
                `;
                return;
            }
            
            // æŒ‰ä¼˜å…ˆçº§æ’åºä»»åŠ¡
            const priorityOrder = { high: 3, medium: 2, low: 1 };
            tasksToRender.sort((a, b) => {
                const aPriority = priorityOrder[a.priority || 'medium'];
                const bPriority = priorityOrder[b.priority || 'medium'];
                return bPriority - aPriority;
            });
            
            tasksToRender.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = `task-item ${task.completed ? 'completed' : ''}`;
                taskElement.setAttribute('data-category', task.category);
                taskElement.setAttribute('data-priority', task.priority || 'medium');
                
                const icon = getTaskTypeIcon(task.category);
                const frequencyText = getFrequencyText(task.frequency);
                const priorityIcon = getPriorityIcon(task.priority || 'medium');
                
                taskElement.innerHTML = `
                    <div class="task-icon ${task.category}">${icon}</div>
                    <div class="task-content">
                        <div class="task-name">${task.title}</div>
                        <div class="task-meta">
                            <span>${frequencyText}</span>
                            <span class="task-points">+${task.points}ç§¯åˆ†</span>
                            <span class="task-priority">${priorityIcon}</span>
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="check-btn ${task.completed ? 'completed' : ''}" onclick="toggleTask('${task.id}')">
                            ${task.completed ? 'âœ“' : 'â—‹'}
                        </button>
                    </div>
                `;
                
                taskList.appendChild(taskElement);
            });
        }
        
        // è·å–é¢‘ç‡æ–‡æœ¬
        function getFrequencyText(frequency) {
            const frequencyMap = {
                daily: 'æ¯æ—¥ä»»åŠ¡',
                weekly: 'æ¯å‘¨ä»»åŠ¡',
                weekend: 'å‘¨æœ«ä»»åŠ¡',
                current_week: 'æœ¬å‘¨ä»»åŠ¡',
                temporary: 'ä¸´æ—¶ä»»åŠ¡'
            };
            return frequencyMap[frequency] || 'æ¯æ—¥ä»»åŠ¡';
        }
        
        // è·å–ä¼˜å…ˆçº§å›¾æ ‡
        function getPriorityIcon(priority) {
            const priorityMap = {
                high: 'ğŸ”´',
                medium: 'ğŸŸ¡',
                low: 'ğŸŸ¢'
            };
            return priorityMap[priority] || 'ğŸŸ¡';
        }
        
        function showAchievements() {
            const unlockedAchievements = getUnlockedAchievements();
            const allAchievements = achievements;
            
            let achievementHtml = '<div class="achievement-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;">';
            achievementHtml += '<div style="background: white; border-radius: 15px; padding: 20px; max-width: 90%; max-height: 80%; overflow-y: auto; width: 400px;">';
            achievementHtml += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">';
            achievementHtml += '<h3 style="margin: 0; color: #333;">ğŸ† æˆå°±ç³»ç»Ÿ</h3>';
            achievementHtml += '<button onclick="closeAchievementModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">Ã—</button>';
            achievementHtml += '</div>';
            
            // æˆå°±ç»Ÿè®¡
            const unlockedCount = unlockedAchievements.length;
            const totalCount = allAchievements.length;
            const completionRate = Math.round((unlockedCount / totalCount) * 100);
            
            achievementHtml += '<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center;">';
            achievementHtml += `<div style="font-size: 24px; font-weight: bold;">${unlockedCount}/${totalCount}</div>`;
            achievementHtml += `<div style="font-size: 14px; opacity: 0.9;">å®Œæˆåº¦ ${completionRate}%</div>`;
            achievementHtml += '</div>';
            
            // æˆå°±åˆ—è¡¨
            achievementHtml += '<div style="max-height: 300px; overflow-y: auto;">';
            
            allAchievements.forEach(achievement => {
                const isUnlocked = unlockedAchievements.some(unlocked => unlocked.id === achievement.id);
                const opacity = isUnlocked ? '1' : '0.5';
                const bgColor = isUnlocked ? '#f8f9fa' : '#f5f5f5';
                const iconFilter = isUnlocked ? '' : 'grayscale(1)';
                
                achievementHtml += `
                    <div style="display: flex; align-items: center; padding: 12px; margin-bottom: 10px; background: ${bgColor}; border-radius: 8px; opacity: ${opacity}; border: ${isUnlocked ? '2px solid #ffd700' : '1px solid #ddd'};">
                        <div style="font-size: 32px; margin-right: 15px; filter: ${iconFilter};">${achievement.icon}</div>
                        <div style="flex: 1;">
                            <div style="font-weight: bold; color: ${isUnlocked ? '#333' : '#999'};">${achievement.name}</div>
                            <div style="font-size: 12px; color: ${isUnlocked ? '#666' : '#999'}; margin: 4px 0;">${achievement.description}</div>
                            <div style="font-size: 12px; color: #f59e0b; font-weight: bold;">+${achievement.points} ç§¯åˆ†</div>
                        </div>
                        ${isUnlocked ? '<div style="color: #27ae60; font-size: 20px;">âœ“</div>' : '<div style="color: #ccc; font-size: 16px;">ğŸ”’</div>'}
                    </div>
                `;
            });
            
            achievementHtml += '</div>';
            achievementHtml += '<button onclick="closeAchievementModal()" style="width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 8px; margin-top: 15px; cursor: pointer;">å…³é—­</button>';
            achievementHtml += '</div></div>';
            
            document.body.insertAdjacentHTML('beforeend', achievementHtml);
        }
        
        // å…³é—­æˆå°±å¼¹çª—
        function closeAchievementModal() {
            const modal = document.querySelector('.achievement-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        function showHelp() {
            showToast('â“ å¸®åŠ©åŠŸèƒ½å¼€å‘ä¸­...');
        }
        
        function showAbout() {
            alert('ğŸ“… æ¯æ—¥æ‰“å¡ v1.0\n\nä¸€ä¸ªç®€å•çš„ä»»åŠ¡ç®¡ç†åº”ç”¨ï¼Œå¸®åŠ©ä½ åŸ¹å…»è‰¯å¥½çš„ä¹ æƒ¯ã€‚\n\nåŠŸèƒ½ç‰¹è‰²ï¼š\nâ€¢ ä»»åŠ¡ç®¡ç†\nâ€¢ ç§¯åˆ†ç³»ç»Ÿ\nâ€¢ æ•°æ®ç»Ÿè®¡\nâ€¢ ç§¯åˆ†å•†åŸ');
        }
        
        function exportData() {
            const data = {
                // åŸºç¡€æ•°æ®
                userProfile: userProfile,
                totalPoints: totalPoints,
                completedTasks: completedTasks,
                
                // ä»»åŠ¡æ•°æ®
                tasks: getAllTasks(),
                
                // æˆå°±æ•°æ®
                unlockedAchievements: getUnlockedAchievements(),
                
                // æƒé™è®¾ç½®
                userMode: localStorage.getItem('userMode') || 'student',
                
                // å•†åŸæ•°æ®
                exchanges: JSON.parse(localStorage.getItem('exchanges') || '[]'),
                
                // ç»Ÿè®¡æ•°æ®
                statistics: {
                    weeklyCompletionRate: calculateWeeklyCompletionRate(),
                    streakDays: userProfile.streakDays,
                    totalTasksCreated: getAllTasks().length,
                    totalTasksCompleted: completedTasks.length
                },
                
                // å¯¼å‡ºä¿¡æ¯
                exportDate: new Date().toISOString(),
                appVersion: '1.0.0'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `æ¯æ—¥æ‰“å¡æ•°æ®-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showToast('ğŸ“¤ æ•°æ®å¯¼å‡ºæˆåŠŸï¼æ–‡ä»¶å·²ä¿å­˜åˆ°ä¸‹è½½æ–‡ä»¶å¤¹');
        }
        
        function clearData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼\n\nå»ºè®®åœ¨æ¸…ç©ºå‰å…ˆå¯¼å‡ºæ•°æ®å¤‡ä»½ã€‚')) {
                // æ¸…ç©ºæ‰€æœ‰æœ¬åœ°å­˜å‚¨æ•°æ®
                localStorage.removeItem('tasks');
                localStorage.removeItem('exchanges');
                localStorage.removeItem('totalPoints');
                localStorage.removeItem('completedTasks');
                localStorage.removeItem('userProfile');
                localStorage.removeItem('unlockedAchievements');
                localStorage.removeItem('userMode');
                localStorage.removeItem('currentUserMode');
                localStorage.removeItem('parentPassword');
                
                // é‡ç½®åº”ç”¨çŠ¶æ€
                tasks = [];
                totalPoints = 0;
                completedTasks = [];
                userProfile = {
                    name: 'å°æ˜',
                    level: 1,
                    avatar: 'ğŸ‘¤',
                    streakDays: 0
                };
                currentUserMode = 'student';
                
                // æ›´æ–°ç•Œé¢
                updateStats();
                renderTasks();
                loadHomePage();
                updateUserModeDisplay();
                
                showToast('ğŸ—‘ï¸ æ‰€æœ‰æ•°æ®å·²æ¸…ç©ºï¼åº”ç”¨å·²é‡ç½®åˆ°åˆå§‹çŠ¶æ€');
            }
        }
        
        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message) {
            // åˆ›å»ºtoastå…ƒç´ 
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #333;
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 10000;
                font-size: 14px;
                max-width: 300px;
                text-align: center;
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            // 3ç§’åç§»é™¤
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 3000);
        }
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('addTaskModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideAddTaskModal();
            }
        });
        
        // ========== æƒé™ç®¡ç†ç³»ç»Ÿ ==========
        
        // æƒé™ç®¡ç†çŠ¶æ€
        let currentUserMode = localStorage.getItem('currentUserMode') || 'student'; // student æˆ– parent
        let parentPassword = localStorage.getItem('parentPassword') || '123456'; // é»˜è®¤å®¶é•¿å¯†ç 
        
        // æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢å¼¹çª—
        function showModeSwitch() {
            const modal = document.getElementById('modeSwitchModal');
            const title = modal.querySelector('.mode-switch-title');
            const passwordInput = document.getElementById('parentPassword');
            
            if (currentUserMode === 'student') {
                title.textContent = 'åˆ‡æ¢åˆ°å®¶é•¿æ¨¡å¼';
                passwordInput.placeholder = 'è¯·è¾“å…¥å®¶é•¿å¯†ç ';
            } else {
                title.textContent = 'åˆ‡æ¢åˆ°å­¦ç”Ÿæ¨¡å¼';
                passwordInput.placeholder = 'ç¡®è®¤åˆ‡æ¢åˆ°å­¦ç”Ÿæ¨¡å¼';
                passwordInput.style.display = 'none';
            }
            
            modal.style.display = 'flex';
            passwordInput.value = '';
            passwordInput.focus();
        }
        
        // éšè—æ¨¡å¼åˆ‡æ¢å¼¹çª—
        function hideModeSwitch() {
            const modal = document.getElementById('modeSwitchModal');
            modal.style.display = 'none';
            document.getElementById('parentPassword').style.display = 'block';
        }
        
        // ç¡®è®¤æ¨¡å¼åˆ‡æ¢
        function confirmModeSwitch() {
            const passwordInput = document.getElementById('parentPassword');
            const inputPassword = passwordInput.value;
            
            if (currentUserMode === 'student') {
                // åˆ‡æ¢åˆ°å®¶é•¿æ¨¡å¼ï¼Œéœ€è¦éªŒè¯å¯†ç 
                if (inputPassword === parentPassword) {
                    currentUserMode = 'parent';
                    localStorage.setItem('currentUserMode', currentUserMode);
                    updateUserModeDisplay();
                    switchTab('parent');
                    hideModeSwitch();
                    showToast('âœ… å·²åˆ‡æ¢åˆ°å®¶é•¿æ¨¡å¼');
                } else {
                    showToast('âŒ å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•');
                    passwordInput.value = '';
                    passwordInput.focus();
                }
            } else {
                // åˆ‡æ¢åˆ°å­¦ç”Ÿæ¨¡å¼ï¼Œæ— éœ€å¯†ç 
                currentUserMode = 'student';
                localStorage.setItem('currentUserMode', currentUserMode);
                updateUserModeDisplay();
                switchTab('home');
                hideModeSwitch();
                showToast('âœ… å·²åˆ‡æ¢åˆ°å­¦ç”Ÿæ¨¡å¼');
            }
        }
        
        // æ›´æ–°ç”¨æˆ·æ¨¡å¼æ˜¾ç¤º
        function updateUserModeDisplay() {
            const modeText = document.getElementById('currentModeText');
            if (modeText) {
                modeText.textContent = currentUserMode === 'student' ? 'å­¦ç”Ÿæ¨¡å¼' : 'å®¶é•¿æ¨¡å¼';
            }
            
            // æ ¹æ®æ¨¡å¼æ˜¾ç¤º/éšè—ç›¸åº”åŠŸèƒ½
            updateUIForUserMode();
        }
        
        // æ ¹æ®ç”¨æˆ·æ¨¡å¼æ›´æ–°UI
        function updateUIForUserMode() {
            const bottomNav = document.querySelector('.bottom-nav');
            
            if (currentUserMode === 'parent') {
                // å®¶é•¿æ¨¡å¼ï¼šéšè—åº•éƒ¨å¯¼èˆªï¼Œæ˜¾ç¤ºå®¶é•¿ç®¡ç†é¡µé¢
                bottomNav.style.display = 'none';
                document.querySelectorAll('.page').forEach(page => {
                    page.style.display = 'none';
                });
                document.getElementById('parentPage').style.display = 'block';
                loadParentPage();
            } else {
                // å­¦ç”Ÿæ¨¡å¼ï¼šæ˜¾ç¤ºåº•éƒ¨å¯¼èˆªï¼Œéšè—å®¶é•¿ç®¡ç†é¡µé¢
                bottomNav.style.display = 'flex';
                document.getElementById('parentPage').style.display = 'none';
                // åˆ‡æ¢åˆ°é¦–é¡µ
                switchTab('home');
            }
        }
        
        // åŠ è½½å®¶é•¿ç®¡ç†é¡µé¢
        function loadParentPage() {
            updateParentAnalysis();
            loadTaskPointsList();
        }
        
        // æ›´æ–°å®¶é•¿æ•°æ®åˆ†æ
        function updateParentAnalysis() {
            // è®¡ç®—æœ¬å‘¨å®Œæˆç‡
            const weeklyRate = calculateWeeklyCompletionRate();
            document.getElementById('weeklyCompletionRate').textContent = weeklyRate + '%';
            
            // è®¡ç®—å¹³å‡æ¯æ—¥ç§¯åˆ†
            const avgPoints = calculateAverageDailyPoints();
            document.getElementById('avgDailyPoints').textContent = avgPoints;
            
            // æ›´æ–°è¿ç»­æ‰“å¡å¤©æ•°
            document.getElementById('streakDaysParent').textContent = userProfile.streakDays;
        }
        
        // è®¡ç®—æœ¬å‘¨å®Œæˆç‡
        function calculateWeeklyCompletionRate() {
            const today = new Date();
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay());
            weekStart.setHours(0, 0, 0, 0);
            
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            weekEnd.setHours(23, 59, 59, 999);
            
            // è®¡ç®—æœ¬å‘¨å®Œæˆçš„ä»»åŠ¡æ•°
            const weekCompletedTasks = completedTasks.filter(task => {
                const taskDate = new Date(task.date || task.completedAt || Date.now());
                return taskDate >= weekStart && taskDate <= weekEnd;
            });
            
            // è®¡ç®—æœ¬å‘¨åº”è¯¥å®Œæˆçš„ä»»åŠ¡æ•°ï¼ˆåŸºäºå½“å‰ä»»åŠ¡åˆ—è¡¨ï¼‰
            const dailyTasks = tasks.filter(task => 
                task.type === 'daily' || 
                task.type === 'school' || 
                task.type === 'home'
            ).length;
            
            const weeklyTasks = tasks.filter(task => task.type === 'weekly').length;
            const daysInWeek = Math.min(7, Math.ceil((Date.now() - weekStart.getTime()) / (1000 * 60 * 60 * 24)) + 1);
            
            const totalExpectedTasks = (dailyTasks * daysInWeek) + weeklyTasks;
            
            return totalExpectedTasks > 0 ? Math.round((weekCompletedTasks.length / totalExpectedTasks) * 100) : 0;
        }
        
        // è®¡ç®—å¹³å‡æ¯æ—¥ç§¯åˆ†
        function calculateAverageDailyPoints() {
            const days = Math.max(userProfile.streakDays, 1);
            return Math.round(totalPoints / days);
        }
        
        // åŠ è½½ä»»åŠ¡ç§¯åˆ†åˆ—è¡¨
        function loadTaskPointsList() {
            const container = document.getElementById('taskPointsList');
            
            if (tasks.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center;">æš‚æ— ä»»åŠ¡</p>';
                return;
            }
            
            container.innerHTML = '';
            tasks.forEach((task, index) => {
                const item = document.createElement('div');
                item.style.cssText = `
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 12px;
                    background: #f8f9fa;
                    border-radius: 8px;
                    margin-bottom: 8px;
                    border-left: 4px solid ${task.completed ? '#28a745' : '#007bff'};
                `;
                
                const typeIcon = getTaskTypeIcon(task.type);
                const typeName = getTaskTypeName(task.type);
                
                item.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 16px;">${typeIcon}</span>
                        <div>
                            <div style="font-weight: 500;">${task.title}</div>
                            <div style="font-size: 12px; color: #666;">${typeName} â€¢ åˆ›å»ºè€…: ${task.createdBy === 'parent' ? 'å®¶é•¿' : 'å­¦ç”Ÿ'}</div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="color: #007bff; font-weight: bold;">${task.points} ç§¯åˆ†</div>
                        <div style="font-size: 12px; color: ${task.completed ? '#28a745' : '#666'};">
                            ${task.completed ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ'}
                        </div>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }
        
        // å®¶é•¿ç®¡ç†åŠŸèƒ½
        function openTaskPointsManagement() {
            showToast('ğŸ“Š ä»»åŠ¡ç§¯åˆ†ç®¡ç†åŠŸèƒ½å¼€å‘ä¸­...');
        }
        
        function manageRewards() {
            showToast('ğŸ å¥–åŠ±ç®¡ç†åŠŸèƒ½å¼€å‘ä¸­...');
        }
        
        function viewRewardHistory() {
            showToast('ğŸ“‹ å…‘æ¢å†å²åŠŸèƒ½å¼€å‘ä¸­...');
        }
        
        function changeParentPassword() {
            const newPassword = prompt('è¯·è¾“å…¥æ–°çš„å®¶é•¿å¯†ç ï¼ˆ6ä½æ•°å­—ï¼‰ï¼š');
            if (newPassword && /^\d{6}$/.test(newPassword)) {
                parentPassword = newPassword;
                localStorage.setItem('parentPassword', parentPassword);
                showToast('âœ… å®¶é•¿å¯†ç ä¿®æ”¹æˆåŠŸ');
            } else if (newPassword) {
                showToast('âŒ å¯†ç æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥6ä½æ•°å­—');
            }
        }
        
        function setReminders() {
            showToast('â° æé†’è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...');
        }
        
        function exportDetailedData() {
            const detailedData = {
                userProfile: userProfile,
                totalPoints: totalPoints,
                completedTasks: completedTasks,
                weeklyCompletionRate: calculateWeeklyCompletionRate(),
                avgDailyPoints: calculateAverageDailyPoints(),
                exchanges: JSON.parse(localStorage.getItem('exchanges') || '[]'),
                exportDate: new Date().toISOString(),
                exportMode: 'parent'
            };
            
            const dataStr = JSON.stringify(detailedData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `parent-report-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showToast('ğŸ“¤ è¯¦ç»†æ•°æ®å¯¼å‡ºæˆåŠŸï¼');
        }
        
        // ä¿®æ”¹åŸæœ‰çš„switchTabå‡½æ•°ä»¥æ”¯æŒå®¶é•¿é¡µé¢
        const originalSwitchTab = switchTab;
        switchTab = function(tabName) {
            if (tabName === 'parent') {
                // åˆ‡æ¢åˆ°å®¶é•¿é¡µé¢
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                    page.style.display = 'none';
                });
                
                const parentPage = document.getElementById('parentPage');
                if (parentPage) {
                    parentPage.classList.add('active');
                    parentPage.style.display = 'block';
                    loadParentPage();
                }
                return;
            }
            
            // å¦‚æœåœ¨å®¶é•¿æ¨¡å¼ä¸‹ï¼Œé˜»æ­¢åˆ‡æ¢åˆ°å…¶ä»–é¡µé¢
            if (currentUserMode === 'parent' && tabName !== 'parent') {
                return;
            }
            
            // è°ƒç”¨åŸå§‹çš„switchTabå‡½æ•°
            originalSwitchTab.call(this, tabName);
        };
        
        // é”®ç›˜äº‹ä»¶ç›‘å¬
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const modal = document.getElementById('modeSwitchModal');
                if (modal.style.display === 'flex') {
                    confirmModeSwitch();
                }
            }
            if (e.key === 'Escape') {
                hideModeSwitch();
            }
        });
        
        // åˆå§‹åŒ–æƒé™ç³»ç»Ÿ
        function initPermissionSystem() {
            updateUserModeDisplay();
            
            // å¦‚æœå½“å‰æ˜¯å®¶é•¿æ¨¡å¼ï¼Œç›´æ¥æ˜¾ç¤ºå®¶é•¿é¡µé¢
            if (currentUserMode === 'parent') {
                updateUIForUserMode();
            }
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        }

        // åˆå§‹åŒ–æƒé™ç³»ç»Ÿ
        function initPermissionSystem() {
            // æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„ç”¨æˆ·æ¨¡å¼
            const savedMode = localStorage.getItem('currentUserMode');
            if (savedMode) {
                currentUserMode = savedMode;
                updateUserModeUI();
            }
        }

        // é”®ç›˜äº‹ä»¶ç›‘å¬
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                hideAddTaskModal();
                hideProductModal();
                hideModeSwitch();
            }
        });

        // åˆå§‹åŒ–åº”ç”¨
        init();
        initPermissionSystem();
    </script>
</body>
</html>
